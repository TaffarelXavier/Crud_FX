/*Desenvolvido por Taffarel Xavier*/
var _IdDaTabela=0;var tabelas=[];delete tabelas[0];var _tabelaExiste=false;function addTabel(){if(_tabelaExiste==false){_IdDaTabela++;var b=$("#nome_da_tabela").val().trim();if(b==""){$("#nome_da_tabela").focus();alert("Insira o nome da tabela corretamente.");return false}if(jQuery.inArray(b,tabelas)>=0){$("#nome_da_tabela").focus();alert("A tabela "+b+" já existe.");return false}tabelas[_IdDaTabela]=b;$("#nome_da_tabela").val("").focus();var i=$("#quantidade_de_linhas").val();var j=$("#prefixo_das_colunas").val();var g=$("#saida");var m='<div id="tabela_'+b+"_"+_IdDaTabela+'"><hr/>';m+='<table id="tab-cabecalho-'+_IdDaTabela+'">';m+='<tr><td><b>Nome da Tabela:</b><input name="table_name['+_IdDaTabela+'][table]" id="tabela_'+b+'" required="" type="text" class="nome-tabela" value="'+b+'"/></td>';m+='<td><b>Prefixo das Colunas:</b><input name="prefixo['+_IdDaTabela+'][prefix]" required="" type="text" value="'+j+'"/></td></tr>';m+="</table>";m+="<br/>";m+='<table id="tab-corpo-'+_IdDaTabela+'" class="table table-borded tabela-crud-tx">';m+="<thead>";m+="<tr>";m+="<th>ORDEM</th>";m+="<th>NOME DA COLUNA</th>";m+="<th>TIPO</th>";m+="<th>QUANT.</th>";m+="<th>NULO</th>";m+="<th>AUTOINCREMENT</th>";m+="<th>PRIMARY</th>";m+="<th>#</th>";m+="</thead>";m+='<tbody id="tab_'+_IdDaTabela+'">';function c(q,o){var p='<select name="col['+q+"]["+o+'][tipo]" required="" class="coluna2">';if(o==1){p+='<option value="INT" selected>INT</option>';p+='<option value="VARCHAR">VARCHAR</option>';p+='<option value="TEXT">TEXT</option>'}else{p+='<option value="INT">INT</option>';p+='<option value="VARCHAR" selected>VARCHAR</option>';p+='<option value="TEXT">TEXT</option>'}p+="</select>";return p}function n(){return'<select class="span1"><option value="TRUE">TRUE</option><option value="FALSE">FALSE</option></select>'}function k(){return'<select class="span1"><option value="TRUE">TRUE</option><option value="FALSE">FALSE</option></select>'}function l(){return'<select class="span1"><option value="TRUE">TRUE</option><option value="FALSE">FALSE</option></select>'}function f(o,p){return'<div><button class="btn btn-success add-linha" type="button" data-tabela-id="'+o+'" data-nome-tabela="'+p+'">Add</button><button class="btn btn-danger excluir-tabela" id="btn_excluir_tabela_'+p+'"data-tabela-id="'+o+'" data-nome-tabela="'+p+'" type="button">Excluir</button><!--<button class="btn btn-success arrumar-tabela" id="btn_arrumar_tabela_'+p+'"data-tabela-id="'+o+'" data-nome-tabela="'+p+'" type="button">Arrumar</button>--></div>'}function a(r,p,q){var o=(p+1);m+='<tr id="linha_'+o+'">';m+='<td class="index-codigo coluna0">'+o+"</td>";m+='<td><input name="col['+r+"]["+o+'][nome]" value="'+q+'"\n        required="" type="text" class="coluna1" /></td>';m+="<td>"+c(r,(o))+"</td>";if(o==1){m+='<td><input type="number" min="1" value="11" name="col['+r+"]["+o+'][quantidade]" class="span1 coluna3" /></td>'}else{m+='<td><input type="number" min="1" value="255" name="col['+r+"]["+o+'][quantidade]" class="span1 coluna3" /></td>'}m+="<td>"+n()+"</td>";m+="<td>"+k()+"</td>";m+="<td>"+l()+"</td>";m+='<td><button class="btn btn-mini btn-danger" id="btn_excluir_linha'+r+"_"+o+'" type="button">x</button></td>';m+="</tr>";return m}function e(o){var p=[];$("#tab-corpo-"+o+" .index-codigo").each(function(){if(($.trim($(this).text()).length>0)){p.push($(this).text())}});return Math.max.apply(null,p)}function d(p){var o=e(p)+1;var q='<tr id="linha_'+o+'">';q+='<td class="index-codigo coluna0">'+o+"</td>";q+='<td><input name="col['+p+"]["+o+'][nome]" value="'+o+'" type="text" class="coluna1" /></td>';q+="<td>"+c(p,o)+"</td>";q+='<td><input type="number" min="1" value="255" name="col['+p+"]["+o+'][quantidade]" class="span1 coluna3" /></td>';q+="<td>"+n()+"</td>";q+="<td>"+k()+"</td>";q+="<td>"+l()+"</td>";q+='<td><button class="btn btn-mini btn-danger" id="btn_excluir_linha'+p+"_"+o+'" type="button">x</button></td>';q+="</tr>";return q}for(_i=0;_i<i;_i++){if(_i==0){a(_IdDaTabela,_i,"id")}else{if(_i==1){a(_IdDaTabela,_i,"nome")}else{a(_IdDaTabela,_i,j+(_i+1))}}var h=(_i+1);m+="<script id='script_"+_IdDaTabela+"_"+h+"'>$('#btn_excluir_linha"+_IdDaTabela+"_"+h+"').click(function () {if (confirm('Deseja realmente excluir este registro?')){$('#linha_' + "+h+").remove();$('#script_"+_IdDaTabela+"_"+h+"').remove();";m+="var _idTabela ="+_IdDaTabela+";";m+="var __col0 = $('#tab-corpo-' + _idTabela).find('.coluna0');";m+="var __col1 = $('#tab-corpo-' + _idTabela).find('.coluna1');";m+="var __col2 = $('#tab-corpo-' + _idTabela).find('.coluna2');";m+="var __col3 = $('#tab-corpo-' + _idTabela).find('.coluna3');";m+="var _totalDeLinhas = $('#tab-corpo-' + _idTabela + ' tr').length - 1;";m+="for (var i = 0; i < _totalDeLinhas; i++) {";m+="var _index = (i + 1);";m+="$(__col0[i]).text(_index);";m+="$(__col1[i]).attr({name: 'col[' + _idTabela + '][' + _index + '][nome]'});";m+="$(__col2[i]).attr({name: 'col[' + _idTabela + '][' + _index + '][tipo]'});";m+="$(__col3[i]).attr({name: 'col[' + _idTabela + '][' + _index + '][quantidade]'});";m+="}";m+="}});";m+="<\/script>"}m+="</table>";m+=f(_IdDaTabela,b);m+='<hr style="border:0px; border-top:1px solid #ccc;">';m+='<script id="myIdTaffarel_'+_IdDaTabela+'">';m+="$('#btn_excluir_tabela_"+b+"').click(function () {";m+="var __idTabela = $(this).attr('data-tabela-id');";m+="var __nomeDaTabela = $(this).attr('data-nome-tabela');";m+="if (confirm('Deseja realmente excluir esta tabela?')) {";m+="tabelas.splice(tabelas.indexOf('"+b+"'), 1 );";m+="_IdDaTabela--;";m+="$('#tabela_' + __nomeDaTabela + '_' + __idTabela).remove();";m+="}";m+="});";m+='$("#btn_arrumar_tabela_'+b+'").click(function () {';m+="var _idTabela = $(this).attr('data-tabela-id');";m+="var __col0 = $('#tab-corpo-' + _idTabela).find('.coluna0');";m+="var __col1 = $('#tab-corpo-' + _idTabela).find('.coluna1');";m+="var __col2 = $('#tab-corpo-' + _idTabela).find('.coluna2');";m+="var __col3 = $('#tab-corpo-' + _idTabela).find('.coluna3');";m+="var _totalDeLinhas = $('#tab-corpo-' + _idTabela + ' tr').length - 1;";m+="for (var i = 0; i < _totalDeLinhas; i++) {";m+="var _index = (i + 1);";m+="$(__col0[i]).text(_index);";m+="$(__col1[i]).attr({name: 'col[' + _idTabela + '][' + _index + '][nome]'});";m+="$(__col2[i]).attr({name: 'col[' + _idTabela + '][' + _index + '][tipo]'});";m+="$(__col3[i]).attr({name: 'col[' + _idTabela + '][' + _index + '][quantidade]'});";m+="}";m+="});";m+="<\/script>";m+="</div>";g.append(m);$(".add-linha").click(function(){var q=$(this).attr("data-tabela-id");var y=$("#tab_"+q);var v=e(q)+1;var p="<script>$('#btn_excluir_linha"+q+"_"+v+"').click(function () {if (confirm('Deseja realmente excluir este registro?')){$('#linha_' + "+v+").remove();}});<\/script>";y.append(d(q)+p);var w=$("#tab-corpo-"+q).find(".coluna0");var u=$("#tab-corpo-"+q).find(".coluna1");var t=$("#tab-corpo-"+q).find(".coluna2");var s=$("#tab-corpo-"+q).find(".coluna3");var o=$("#tab-corpo-"+q+" tr").length-1;for(var r=0;r<o;r++){var x=(r+1);$(w[r]).text(x);$(u[r]).attr({name:"col["+q+"]["+x+"][nome]"});$(t[r]).attr({name:"col["+q+"]["+x+"][tipo]"});$(s[r]).attr({name:"col["+q+"]["+x+"][quantidade]"})}});$(".coluna1").click(function(){this.select()})}}$("#btn_adicionar_tabela").click(function(){verificarSeTabelaExiste()});function verificarSeTabelaExiste(){var a=$("#nome_da_tabela");$.post("../modelos/acoes.php",{tabela:a.val().trim()},function(b){if(b=="1"){_tabelaExiste=true;a.select();alert("A tabela "+a.val().trim()+" já existe.");a.val("")}else{addTabel()}});return _tabelaExiste}$("#nome_da_tabela").keyup(function(b){var a=this.value.trim();$("#prefixo_das_colunas").val(a.substring(3,0).toLowerCase()+"_");_tabelaExiste=false;if(b.keyCode==13){verificarSeTabelaExiste()}});$("#nome_do_projeto").keyup(function(b){var a=this.value.trim();if(b.keyCode==13){if(a===""){alert("Preencha corretamente o nome do projeto.");return false}$("#nome_da_tabela").focus()}});function organizarTabela(){var g=document.getElementsByClassName("tabela-crud-tx");for(var d=0;d<g.length;d++){var b=g[d].tBodies[0].rows;var f=g[d].tBodies[0].id.split("_");var c=b.length;for(var a=0;a<c;a++){var e=(a+1);$(b[a].cells[0]).text(e);$(b[a].cells[1]).find(".coluna1").attr({name:"col["+f[1]+"]["+e+"][nome]"});$(b[a].cells[2]).find(".coluna2").attr({name:"col["+f[1]+"]["+e+"][tipo]"});$(b[a].cells[3]).find(".coluna3").attr({name:"col["+f[1]+"]["+e+"][quantidade]"})}}}$(this).on("mousemove",function(){organizarTabela()});var btnCriarProjeto=$(".btn-criar-projeto");$("#form_analisar").ajaxForm({beforeSend:function(){organizarTabela();btnCriarProjeto.attr("disabled",true).html("Salvando, aguarde, por favor...")},uploadProgress:function(e,a,d,c){var b=c+"%"},success:function(a){$("#resultado_request").html(a);btnCriarProjeto.attr("disabled",false).html('<i class="fas fa-save"></i> Criar Projeto')},complete:function(a){}});